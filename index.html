<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>加密貨幣交易記錄系統</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft JhengHei', sans-serif;
            background: #fafafa;
            padding: 40px 20px;
            min-height: 100vh;
            color: #1a1a1a;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        h1 {
            color: #1a1a1a;
            text-align: center;
            margin-bottom: 50px;
            font-size: 2em;
            font-weight: 300;
            letter-spacing: -0.5px;
        }

        h2 {
            font-size: 1.1em;
            font-weight: 400;
            color: #666;
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .section-divider {
            height: 1px;
            background: #e0e0e0;
            margin: 50px 0;
        }

        .form-section {
            background: white;
            padding: 40px;
            border-radius: 2px;
            margin-bottom: 40px;
            border: 1px solid #e0e0e0;
        }

        .section-title {
            font-size: 0.85em;
            font-weight: 500;
            color: #999;
            margin: 30px 0 15px 0;
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
        }

        label {
            font-weight: 400;
            margin-bottom: 8px;
            color: #666;
            font-size: 13px;
        }

        input, select, textarea {
            padding: 12px 14px;
            border: 1px solid #e0e0e0;
            border-radius: 2px;
            font-size: 14px;
            transition: all 0.2s;
            background: #fafafa;
            font-family: inherit;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: #1a1a1a;
            background: white;
        }

        textarea {
            resize: vertical;
            min-height: 80px;
        }

        .button-group {
            display: flex;
            gap: 12px;
            justify-content: flex-start;
            margin-top: 30px;
        }

        button {
            padding: 12px 24px;
            border: 1px solid #1a1a1a;
            border-radius: 2px;
            font-size: 13px;
            font-weight: 400;
            cursor: pointer;
            transition: all 0.2s;
            background: white;
            color: #1a1a1a;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-primary {
            background: #1a1a1a;
            color: white;
        }

        .btn-primary:hover {
            background: #333;
        }

        button:hover {
            background: #f5f5f5;
        }

        .btn-danger {
            border-color: #d32f2f;
            color: #d32f2f;
        }

        .btn-danger:hover {
            background: #d32f2f;
            color: white;
        }

        .records-section {
            margin-top: 40px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            border: 1px solid #e0e0e0;
            padding: 30px 25px;
            border-radius: 2px;
            text-align: left;
        }

        .stat-card h3 {
            font-size: 11px;
            margin-bottom: 12px;
            color: #999;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .stat-card .value {
            font-size: 28px;
            font-weight: 300;
            color: #1a1a1a;
        }

        .filter-section {
            background: white;
            padding: 30px;
            border-radius: 2px;
            margin-bottom: 30px;
            border: 1px solid #e0e0e0;
        }

        .filter-row {
            display: flex;
            gap: 15px;
            align-items: end;
            flex-wrap: wrap;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: white;
            border: 1px solid #e0e0e0;
        }

        th, td {
            padding: 16px 12px;
            text-align: left;
            border-bottom: 1px solid #f0f0f0;
            font-size: 13px;
        }

        th {
            background: #fafafa;
            color: #666;
            font-weight: 500;
            position: sticky;
            top: 0;
            text-transform: uppercase;
            font-size: 11px;
            letter-spacing: 0.5px;
        }

        tr:hover {
            background: #fafafa;
        }

        .profit {
            color: #2e7d32;
        }

        .loss {
            color: #d32f2f;
        }

        .action-btns {
            display: flex;
            gap: 8px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 11px;
        }

        .table-container {
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
            border-radius: 2px;
        }

        .required {
            color: #d32f2f;
        }

        .metaphysics-section {
            background: #f9f9f9;
            padding: 25px;
            border-radius: 2px;
            margin-top: 25px;
            border: 1px dashed #ddd;
        }

        @media (max-width: 768px) {
            body {
                padding: 20px 10px;
            }

            .container {
                padding: 0;
            }

            .form-section {
                padding: 20px 15px;
                margin-bottom: 20px;
                border-radius: 8px;
            }

            .form-row {
                grid-template-columns: 1fr;
                gap: 15px;
                margin-bottom: 15px;
            }

            h1 {
                font-size: 1.5em;
                margin-bottom: 30px;
            }

            h2 {
                font-size: 1em;
            }

            .section-title {
                font-size: 0.75em;
                margin: 20px 0 10px 0;
            }

            input, select, textarea {
                padding: 14px 12px;
                font-size: 16px; /* 防止 iOS 自動縮放 */
            }

            label {
                font-size: 14px;
                margin-bottom: 6px;
            }

            .button-group {
                flex-direction: column;
                gap: 10px;
            }

            button, .btn-primary, .btn-secondary, .btn-danger {
                width: 100%;
                padding: 14px;
                font-size: 15px;
            }

            .btn-small {
                padding: 10px 14px;
                font-size: 13px;
            }

            .stats-grid {
                grid-template-columns: 1fr 1fr;
                gap: 10px;
            }

            .stat-card {
                padding: 15px;
            }

            .stat-card .label {
                font-size: 11px;
            }

            .stat-card .value {
                font-size: 20px;
            }

            .filters {
                flex-direction: column;
                gap: 12px;
            }

            .filter-group {
                width: 100%;
            }

            .table-container {
                max-height: 400px;
                border-radius: 8px;
            }

            table {
                font-size: 12px;
            }

            th, td {
                padding: 10px 8px;
                font-size: 12px;
            }

            th {
                font-size: 10px;
            }

            .action-btns {
                flex-direction: column;
                gap: 5px;
            }

            .action-btns button {
                width: 100%;
            }

            .metaphysics-section {
                padding: 15px;
                margin-top: 15px;
            }

            /* 手機版橫向捲動優化 */
            .table-container::-webkit-scrollbar {
                height: 6px;
            }

            .table-container::-webkit-scrollbar-thumb {
                background: #ccc;
                border-radius: 3px;
            }
        }

        /* 小螢幕手機優化 (iPhone SE 等) */
        @media (max-width: 375px) {
            body {
                padding: 15px 8px;
            }

            .form-section {
                padding: 15px 12px;
            }

            h1 {
                font-size: 1.3em;
            }

            .stats-grid {
                grid-template-columns: 1fr;
            }

            input, select, textarea {
                padding: 12px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Crypto Trading Journal</h1>

        <!-- 交易記錄表單 -->
        <div class="form-section">
            <h2>新增交易記錄</h2>
            <form id="tradingForm">
                <div class="section-title">交易資訊</div>
                <div class="form-row">
                    <div class="form-group">
                        <label>交易日期 <span class="required">*</span></label>
                        <input type="datetime-local" id="tradeDate" required>
                    </div>
                    <div class="form-group">
                        <label>交易類型 <span class="required">*</span></label>
                        <div style="display: flex; gap: 8px;">
                            <select id="tradeType" required style="flex: 1;">
                                <option value="">請選擇</option>
                            </select>
                            <button type="button" onclick="manageTradeTypes()" style="padding: 8px 16px; white-space: nowrap;">管理</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>幣種 <span class="required">*</span></label>
                        <input type="text" id="coinSymbol" placeholder="BTC, ETH, SOL" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>交易數量 <span class="required">*</span></label>
                        <input type="number" id="quantity" step="0.00000001" placeholder="0.00" required>
                    </div>
                    <div class="form-group">
                        <label>單價 (USD) <span class="required">*</span></label>
                        <input type="number" id="price" step="0.01" placeholder="0.00" required>
                    </div>
                    <div class="form-group">
                        <label>手續費 (USD)</label>
                        <input type="number" id="fee" step="0.01" placeholder="0.00" value="0">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>槓桿倍數</label>
                        <input type="number" id="leverage" step="0.1" placeholder="1" value="1">
                    </div>
                    <div class="form-group">
                        <label>持倉時長 (小時)</label>
                        <input type="number" id="holdingPeriod" step="0.1" placeholder="自動計算或手動填寫">
                    </div>
                    <div class="form-group">
                        <label>風險報酬比</label>
                        <input type="number" id="riskRewardRatio" step="0.1" placeholder="例如: 3 (代表1:3)">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>交易所/平台 <span class="required">*</span></label>
                        <div style="display: flex; gap: 8px;">
                            <select id="exchange" required style="flex: 1;">
                                <option value="">請選擇</option>
                            </select>
                            <button type="button" onclick="manageExchanges()" style="padding: 8px 16px; white-space: nowrap;">管理</button>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>交易對</label>
                        <input type="text" id="tradingPair" placeholder="BTC/USDT">
                    </div>
                    <div class="form-group">
                        <label>策略類型</label>
                        <div style="display: flex; gap: 8px;">
                            <select id="strategy" style="flex: 1;">
                                <option value="">請選擇</option>
                            </select>
                            <button type="button" onclick="manageStrategies()" style="padding: 8px 16px; white-space: nowrap;">管理</button>
                        </div>
                    </div>
                </div>

                <div class="section-title">損益資訊</div>
                <div class="form-row">
                    <div class="form-group">
                        <label>盈虧 (USD)</label>
                        <input type="number" id="profitLoss" step="0.01" placeholder="正數為盈利，負數為虧損">
                    </div>
                    <div class="form-group">
                        <label>盈虧比例 (%)</label>
                        <input type="number" id="profitLossPercent" step="0.01" placeholder="0.00">
                    </div>
                    <div class="form-group">
                        <label>最大回撤 (%)</label>
                        <input type="number" id="maxDrawdown" step="0.01" placeholder="持倉期間最大虧損比例">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>進場理由</label>
                        <select id="entryReason">
                            <option value="">請選擇</option>
                            <option value="技術指標">技術指標</option>
                            <option value="突破支撐/壓力">突破支撐/壓力</option>
                            <option value="基本面消息">基本面消息</option>
                            <option value="跟單">跟單</option>
                            <option value="直覺">直覺</option>
                            <option value="抄底/追高">抄底/追高</option>
                            <option value="定投計畫">定投計畫</option>
                            <option value="套利機會">套利機會</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>出場理由</label>
                        <select id="exitReason">
                            <option value="">請選擇</option>
                            <option value="止盈">止盈</option>
                            <option value="止損">止損</option>
                            <option value="技術指標反轉">技術指標反轉</option>
                            <option value="消息面">消息面</option>
                            <option value="恐慌出場">恐慌出場</option>
                            <option value="貪婪持有">貪婪持有</option>
                            <option value="時間到期">時間到期</option>
                            <option value="資金需求">資金需求</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>平倉後心情</label>
                        <select id="postTradeMood">
                            <option value="">請選擇</option>
                            <option value="滿意">滿意</option>
                            <option value="非常滿意">非常滿意</option>
                            <option value="後悔">後悔</option>
                            <option value="非常後悔">非常後悔</option>
                            <option value="平靜">平靜</option>
                            <option value="興奮">興奮</option>
                            <option value="沮喪">沮喪</option>
                            <option value="憤怒">憤怒</option>
                            <option value="釋然">釋然</option>
                            <option value="緊張">緊張</option>
                        </select>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group" style="grid-column: 1/-1;">
                        <label>交易檢討</label>
                        <textarea id="review" placeholder="記錄這筆交易的得失、經驗教訓..."></textarea>
                    </div>
                </div>

                <!-- 開倉玄學參數 -->
                <div class="metaphysics-section">
                    <div class="section-title">開倉環境記錄</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>開倉時間</label>
                            <input type="datetime-local" id="entryTime" placeholder="開倉具體時間">
                        </div>
                        <div class="form-group">
                            <label>開倉地點</label>
                            <input type="text" id="entryLocation" placeholder="家裡、辦公室、咖啡廳">
                        </div>
                        <div class="form-group">
                            <label>開倉心情</label>
                            <div style="display: flex; gap: 8px;">
                                <select id="entryMood" style="flex: 1;">
                                    <option value="">請選擇</option>
                                </select>
                                <button type="button" onclick="manageEntryMoods()" style="padding: 8px 16px; white-space: nowrap;">管理</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>開倉天氣</label>
                            <select id="entryWeather">
                                <option value="">請選擇</option>
                                <option value="晴天">晴天</option>
                                <option value="陰天">陰天</option>
                                <option value="雨天">雨天</option>
                                <option value="多雲">多雲</option>
                                <option value="颱風">颱風</option>
                                <option value="霧霾">霧霾</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>開倉身體狀況</label>
                            <select id="entryPhysical">
                                <option value="">請選擇</option>
                                <option value="精力充沛">精力充沛</option>
                                <option value="普通">普通</option>
                                <option value="疲憊">疲憊</option>
                                <option value="生病">生病</option>
                                <option value="失眠">失眠</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>開倉前睡眠時間</label>
                            <input type="number" id="entrySleepHours" step="0.5" placeholder="小時">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group" style="grid-column: 1/-1;">
                            <label>開倉時周圍人事物</label>
                            <textarea id="entrySurroundings" placeholder="獨自一人、朋友在旁、辦公室同事、咖啡廳環境..."></textarea>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group" style="grid-column: 1/-1;">
                            <label>開倉時發生的事</label>
                            <textarea id="entryHappenings" placeholder="剛看到某個新聞、收到消息、群組討論內容..."></textarea>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group" style="grid-column: 1/-1;">
                            <label>開倉當下感想</label>
                            <textarea id="entryThoughts" placeholder="開倉瞬間的想法、直覺、預期..."></textarea>
                        </div>
                    </div>
                </div>

                <!-- 平倉玄學參數 -->
                <div class="metaphysics-section" style="margin-top: 20px;">
                    <div class="section-title">平倉環境記錄</div>
                    <div class="form-row">
                        <div class="form-group">
                            <label>平倉時間</label>
                            <input type="datetime-local" id="exitTime" placeholder="平倉具體時間">
                        </div>
                        <div class="form-group">
                            <label>平倉地點</label>
                            <input type="text" id="exitLocation" placeholder="家裡、辦公室、咖啡廳">
                        </div>
                        <div class="form-group">
                            <label>平倉前心情</label>
                            <div style="display: flex; gap: 8px;">
                                <select id="exitMoodBefore" style="flex: 1;">
                                    <option value="">請選擇</option>
                                </select>
                                <button type="button" onclick="manageExitMoods()" style="padding: 8px 16px; white-space: nowrap;">管理</button>
                            </div>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label>平倉天氣</label>
                            <select id="exitWeather">
                                <option value="">請選擇</option>
                                <option value="晴天">晴天</option>
                                <option value="陰天">陰天</option>
                                <option value="雨天">雨天</option>
                                <option value="多雲">多雲</option>
                                <option value="颱風">颱風</option>
                                <option value="霧霾">霧霾</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>平倉身體狀況</label>
                            <select id="exitPhysical">
                                <option value="">請選擇</option>
                                <option value="精力充沛">精力充沛</option>
                                <option value="普通">普通</option>
                                <option value="疲憊">疲憊</option>
                                <option value="生病">生病</option>
                                <option value="失眠">失眠</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>平倉前睡眠時間</label>
                            <input type="number" id="exitSleepHours" step="0.5" placeholder="小時">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group" style="grid-column: 1/-1;">
                            <label>平倉時周圍人事物</label>
                            <textarea id="exitSurroundings" placeholder="獨自一人、朋友在旁、辦公室同事、咖啡廳環境..."></textarea>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group" style="grid-column: 1/-1;">
                            <label>平倉時發生的事</label>
                            <textarea id="exitHappenings" placeholder="剛看到某個新聞、收到消息、群組討論內容..."></textarea>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group" style="grid-column: 1/-1;">
                            <label>平倉當下感想</label>
                            <textarea id="exitThoughts" placeholder="平倉瞬間的想法、是否後悔、預期判斷..."></textarea>
                        </div>
                    </div>
                </div>

                <div class="section-title" style="margin-top: 25px;">備註</div>
                <div class="form-row">
                    <div class="form-group" style="grid-column: 1/-1;">
                        <label>交易備註</label>
                        <textarea id="notes" placeholder="記錄交易原因、技術分析、市場觀察..."></textarea>
                    </div>
                </div>

                <div class="button-group">
                    <button type="submit" class="btn-primary">新增記錄</button>
                    <button type="button" onclick="resetForm()">清除表單</button>
                </div>
            </form>
        </div>

        <div class="section-divider"></div>

        <!-- 篩選與統計 -->
        <div class="records-section">
            <h2>交易記錄與分析</h2>

            <!-- 統計卡片 -->
            <div class="stats-grid">
                <div class="stat-card">
                    <h3>總交易次數</h3>
                    <div class="value" id="totalTrades">0</div>
                </div>
                <div class="stat-card">
                    <h3>總盈虧 (USD)</h3>
                    <div class="value" id="totalProfitLoss">$0.00</div>
                </div>
                <div class="stat-card">
                    <h3>總手續費 (USD)</h3>
                    <div class="value" id="totalFees">$0.00</div>
                </div>
                <div class="stat-card">
                    <h3>勝率</h3>
                    <div class="value" id="winRate">0%</div>
                </div>
            </div>

            <!-- 篩選器 -->
            <div class="filter-section">
                <div class="filter-row">
                    <div class="form-group">
                        <label>時間範圍</label>
                        <select id="timeFilter" onchange="filterRecords()">
                            <option value="all">全部</option>
                            <option value="week">本週</option>
                            <option value="month">本月</option>
                            <option value="quarter">本季</option>
                            <option value="custom">自訂範圍</option>
                        </select>
                    </div>
                    <div class="form-group" id="customDateFrom" style="display:none;">
                        <label>開始日期</label>
                        <input type="date" id="dateFrom">
                    </div>
                    <div class="form-group" id="customDateTo" style="display:none;">
                        <label>結束日期</label>
                        <input type="date" id="dateTo">
                    </div>
                    <div class="form-group">
                        <label>幣種</label>
                        <select id="coinFilter" onchange="filterRecords()">
                            <option value="all">全部</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>交易類型</label>
                        <select id="typeFilter" onchange="filterRecords()">
                            <option value="all">全部</option>
                            <option value="買入">買入</option>
                            <option value="賣出">賣出</option>
                            <option value="轉換">轉換</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- 匯出按鈕 -->
            <div class="button-group" style="margin-bottom: 30px;">
                <button onclick="exportToExcel('all')">📊 匯出 Excel (全部)</button>
                <button onclick="exportToExcel('week')">📊 匯出 Excel (本週)</button>
                <button onclick="exportToExcel('month')">📊 匯出 Excel (本月)</button>
                <button onclick="exportToExcel('quarter')">📊 匯出 Excel (本季)</button>
            </div>

            <!-- 資料同步按鈕 -->
            <div class="button-group" style="margin-bottom: 30px; border-top: 1px solid #e0e0e0; padding-top: 20px;">
                <button class="btn-secondary" onclick="exportToJSON()">💾 備份資料 (JSON)</button>
                <button class="btn-secondary" onclick="importFromJSON()">📥 匯入資料 (JSON)</button>
                <button class="btn-danger" onclick="clearAllData()">🗑️ 清空所有記錄</button>
            </div>

            <div style="background: #f0f7ff; padding: 15px; border-radius: 4px; margin-bottom: 30px; border-left: 4px solid #2196F3;">
                <strong>💡 跨裝置同步說明：</strong>
                <ul style="margin: 10px 0 0 20px; line-height: 1.8;">
                    <li>在手機上點擊「<strong>備份資料 (JSON)</strong>」→ 產生備份檔</li>
                    <li>將備份檔傳到電腦（透過 Line、AirDrop、雲端等）</li>
                    <li>在電腦上點擊「<strong>匯入資料 (JSON)</strong>」→ 選擇備份檔</li>
                    <li>選擇「<strong>合併模式</strong>」可保留兩邊資料並合併</li>
                </ul>
            </div>

            <!-- 交易記錄表格 -->
            <div class="table-container">
                <table id="recordsTable">
                    <thead>
                        <tr>
                            <th>日期時間</th>
                            <th>類型</th>
                            <th>幣種</th>
                            <th>數量</th>
                            <th>單價</th>
                            <th>總額</th>
                            <th>手續費</th>
                            <th>盈虧</th>
                            <th>盈虧%</th>
                            <th>平倉心情</th>
                            <th>交易所</th>
                            <th>策略</th>
                            <th>地點</th>
                            <th>心情</th>
                            <th>時段</th>
                            <th>天氣</th>
                            <th>星期</th>
                            <th>身體</th>
                            <th>備註</th>
                            <th>操作</th>
                        </tr>
                    </thead>
                    <tbody id="recordsBody">
                        <tr>
                            <td colspan="20" style="text-align: center; padding: 50px; color: #999;">
                                尚無交易記錄
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <script src="crypto_tracker.js"></script>
</body>
</html>